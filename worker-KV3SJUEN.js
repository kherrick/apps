addEventListener("message",async i=>{let b=i.data?.password||"",g=i.data?.payload||"",u=e=>btoa(new Uint8Array(e).reduce((a,t)=>a+String.fromCharCode(t),"")),w=e=>Uint8Array.from(atob(e),a=>a.charCodeAt(0)),p=async e=>globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(e),"PBKDF2",!1,["deriveKey"]),d=(e,a,t)=>globalThis.crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:6e5,hash:"SHA-512"},e,{name:"AES-GCM",length:256},!1,t),h=async(e,a)=>{let t=globalThis.crypto.getRandomValues(new Uint8Array(16)),n=globalThis.crypto.getRandomValues(new Uint8Array(12)),c=await p(a),o=await d(c,t,["encrypt"]);return await globalThis.crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,await new Blob([e]).arrayBuffer()).then(y=>{let r=new Uint8Array(y),s=new Uint8Array(t.byteLength+n.byteLength+r.byteLength);return s.set(t,0),s.set(n,t.byteLength),s.set(r,t.byteLength+n.byteLength),u(s)})},f=async(e,a)=>{let t=globalThis.crypto.getRandomValues(new Uint8Array(16)),n=globalThis.crypto.getRandomValues(new Uint8Array(12)),c=await p(a),o=await d(c,t,["encrypt"]);return await globalThis.crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,await e.arrayBuffer()).then(y=>{let r=new Uint8Array(y),s=new Uint8Array(t.byteLength+n.byteLength+r.byteLength);return s.set(t,0),s.set(n,t.byteLength),s.set(r,t.byteLength+n.byteLength),{filename:e.name,buffer:s}})},A=async(e,a)=>{let t=await e.arrayBuffer(),n=t.slice(0,16),c=t.slice(16,28),o=t.slice(28),y=await p(a),r=await d(y,n,["decrypt"]),s=await globalThis.crypto.subtle.decrypt({name:"AES-GCM",iv:c},r,o);return{filename:e.name,buffer:s}},m=async(e,a)=>{let t=w(e),n=t.slice(0,16),c=t.slice(16,28),o=t.slice(28),y=await p(a),r=await d(y,n,["decrypt"]);return await globalThis.crypto.subtle.decrypt({name:"AES-GCM",iv:c},r,o)},l=null;try{switch(i.data?.intent){case"encrypt-text":l=await h(g,b);break;case"decrypt-text":l=await m(g,b);break;case"encrypt-file":l=await f(g,b);break;case"decrypt-file":l=await A(g,b);break;default:break}}catch(e){postMessage({result:null,intent:i.data?.intent,error:e})}postMessage({result:l,intent:i.data?.intent,error:null})});
