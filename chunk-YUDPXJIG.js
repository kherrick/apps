import"./chunk-VN3CQEPZ.js";import{b as be,d as ke,e as Te,f as ye,g as Ie}from"./chunk-RZYJN5W5.js";import{a as ue,d as me,f as _e,g as pe,i as ge,j as fe,k as ve}from"./chunk-I63IY55C.js";import{a as we,b as Me}from"./chunk-R5HUIKZV.js";import{a as ce,b as he}from"./chunk-NNRU5O4N.js";import{a as xe}from"./chunk-HFAQQ3MF.js";import{c as ne,d as re,f as oe}from"./chunk-DJQVH27H.js";import"./chunk-Y34SIOJT.js";import{a as le,f as de}from"./chunk-YMII22LY.js";import{t as se}from"./chunk-IDN5DYBR.js";import"./chunk-PKQDKLAP.js";import{l as ie,m as ae,q as D}from"./chunk-ATYHLBKA.js";import{Ab as N,Bb as k,Cb as r,Cc as ee,Da as q,Db as l,Dc as te,Eb as T,Ib as V,Mb as m,Ob as _,Sb as I,Tb as x,Ub as w,Va as d,Yb as Y,Z,Zb as y,ac as B,ba as E,bc as c,cc as X,dc as M,fb as P,fc as L,ga as h,gb as G,gc as F,ha as u,hc as W,nc as K,pc as J,ra as C,wb as v,xb as b,zb as O}from"./chunk-PMUBQ4SH.js";import{a as S,b as R}from"./chunk-DAQOROHW.js";var Se=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=G({type:o});static \u0275inj=Z({imports:[se,ne]})}return o})();function Re(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,o=>(+o^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+o/4).toString(16))}var Le=["videoElement"],Fe=["captureCanvas"],We=["canvas"],ze=(o,t)=>t.id;function He(o,t){if(o&1&&(r(0,"mat-card",11),T(1,"video",21,1)(3,"canvas",22,2),l()),o&2){let e=_();d(),y("display",e.isCameraActive()?"block":"none")}}function Qe(o,t){if(o&1){let e=V();r(0,"button",23),m("click",function(){h(e);let a=_();return u(a.captureFromCamera())}),r(1,"mat-icon"),c(2,"photo_camera"),l(),c(3," Capture Photo "),l()}}function $e(o,t){if(o&1&&(r(0,"div",18),T(1,"mat-progress-bar",24),r(2,"div",25)(3,"div",26),c(4),l(),r(5,"div"),c(6),K(7,"number"),l()()()),o&2){let e=_();d(),k("value",e.downloadProgress().current/e.downloadProgress().total*100),d(3),M(" ",e.downloadProgress().key," "),d(2),M(" ",J(7,3,e.downloadProgress().current/e.downloadProgress().total*100,"1.0"),"% ")}}function je(o,t){if(o&1){let e=V();r(0,"div",30),c(1),l(),r(2,"div",31)(3,"button",32),m("click",function(){h(e);let a=_().$implicit,s=_();return u(s.downloadCanvas(a.id))}),r(4,"mat-icon"),c(5,"download"),l(),c(6," Download Image "),l()()}if(o&2){let e=_().$implicit;d(),M(" Found ",e.detections.length," signature(s) "),d(2),k("disabled",!e.detections||e.detections.length===0)}}function Ze(o,t){o&1&&(r(0,"div",30),c(1,"No signatures detected"),l())}function qe(o,t){if(o&1&&(r(0,"mat-card",20),T(1,"div",27),r(2,"div",28),T(3,"canvas",29,3),v(5,je,7,2)(6,Ze,2,0,"div",30),l()()),o&2){let e=t.$implicit;d(),y("display",e.loading?"":"none"),d(),y("display",e.loading?"none":""),d(),y("display",e.detections&&e.detections.length>0?"block":"none"),k("id","canvas-"+e.id),d(2),b(e.detections&&e.detections.length>0?5:e.loading?-1:6)}}var Ee={key:"",current:0,total:0},Ce=class o{imageItems=C([]);downloadProgress=C(Ee);dropZoneStyles="drop-zone";confThreshold=.5;iouThreshold=.5;isCameraActive=C(!1);isBrowser=!1;#t=E(te);#n=E(q);#r=E(xe);#e=null;#s=!1;#o=[];#i=new Map;#a=null;canvasElements;videoElement;captureCanvas;get reversedImageItems(){return[...this.imageItems()].reverse()}ngAfterViewChecked(){this.#i.size>0&&this.#u()}#u(){this.#i.forEach((t,e)=>{let i=this.canvasElements?.find(a=>a.nativeElement.id===`canvas-${e}`);if(i){let a=i.nativeElement;a.style.display="block",setTimeout(()=>{this.#g(e,t.imageData,t.detections,a),this.#i.delete(e)},10)}})}onThresholdChange(){this.#e&&this.#e.postMessage({type:"updateThresholds",confThreshold:this.confThreshold,iouThreshold:this.iouThreshold})}async toggleCamera(){if(!this.isBrowser){this.#r.openDialog("Camera is not available in this environment.",{title:"Camera Unavailable",modal:!0});return}this.isCameraActive()?await this.#h():await this.#m()}async#m(){try{this.#a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),this.isCameraActive.set(!0),this.#t.markForCheck(),setTimeout(()=>{this.videoElement&&(this.videoElement.nativeElement.srcObject=this.#a)},100)}catch(t){console.error("Error accessing camera:",t),this.#r.openDialog("Failed to access camera. Please ensure you have granted camera permissions.",{title:"Camera Error",modal:!0})}}async#h(){this.#a&&(this.#a.getTracks().forEach(t=>t.stop()),this.#a=null),this.isCameraActive.set(!1),this.#t.markForCheck()}captureFromCamera(){if(!this.videoElement||!this.captureCanvas)return;let t=this.videoElement.nativeElement,e=this.captureCanvas.nativeElement,i=e.getContext("2d");!i||t.videoWidth===0||t.videoHeight===0||(e.width=t.videoWidth,e.height=t.videoHeight,i.drawImage(t,0,0),e.toBlob(a=>{if(a){let s=new File([a],`camera-capture-${Date.now()}.jpg`,{type:"image/jpeg"});this.#l([s])}},"image/jpeg",.8))}downloadCanvas(t){let e=this.canvasElements?.find(a=>a.nativeElement.id===`canvas-${t}`);if(!e){console.error("Canvas not found for image ID:",t);return}e.nativeElement.toBlob(a=>{if(a){let s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=`signature-detection-${t}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}},"image/png")}handleFileSelect(t){let e=t.target.files;e&&this.#l(e),t.target.value=""}handleDrop(t){t.preventDefault(),this.dropZoneStyles="drop-zone",this.#t?.markForCheck(),t.dataTransfer?.files&&this.#l(t.dataTransfer.files)}handleDragLeave(){this.dropZoneStyles="drop-zone",this.#t?.markForCheck()}handleDragOver(t){t.preventDefault(),this.dropZoneStyles="drop-zone-hover",this.#t?.markForCheck()}#l(t){for(let e=0;e<t.length;e++){let i;try{i=globalThis.crypto.randomUUID()}catch{i=Re()}let a=URL.createObjectURL(t[e]);this.imageItems.update(s=>[...s,{id:i,originalUrl:a,loading:!0,file:t[e]}]),this.#o.push({file:t[e],id:i})}this.#d()}#d(){if(this.#s||this.#o.length===0)return;let{file:t,id:e}=this.#o.shift();this.#s=!0,this.#_(t,e)}async#_(t,e){if(D(this.#n)){if(!this.#e){console.error("Worker not initialized"),this.#c(e);return}try{let i=await this.#p(t);this.imageItems.update(a=>a.map(s=>s.id===e?R(S({},s),{originalImage:i}):s)),this.#e.postMessage({type:"detect",wasmPath:`${globalThis.location.origin}/${ee()?"assets":"apps/assets"}/onnxruntime-web/`,id:e,file:t,confThreshold:this.confThreshold,iouThreshold:this.iouThreshold})}catch(i){console.error("Error processing image:",i),this.#c(e)}}}#c(t){this.imageItems.update(e=>e.map(i=>i.id===t?R(S({},i),{loading:!1,detections:[]}):i)),this.#s=!1,this.#d()}#p(t){return new Promise((e,i)=>{let a=new FileReader;a.onload=s=>{let n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=s.target?.result},a.onerror=i,a.readAsDataURL(t)})}#g(t,e,i,a){let s=a.getContext("2d");if(!s)return;let n=this.imageItems().find(p=>p.id===t)?.originalImage;if(!n)return;let z=500,H=400,{width:g,height:f}=n;if(g>z||f>H){let p=Math.min(z/g,H/f);g*=p,f*=p}a.width=g,a.height=f,s.drawImage(n,0,0,g,f);let Q=g/n.width,$=f/n.height;i.forEach((p,Ge)=>{let{x:Ve,y:De,width:Ae,height:Ue,confidence:Pe}=p,A=Ve*Q,U=De*$,Oe=Ae*Q,Ne=Ue*$;s.strokeStyle="red",s.lineWidth=3,s.strokeRect(A,U,Oe,Ne);let j=`${p.class}: ${Pe.toFixed(2)}`;s.fillStyle="red",s.font="16px Arial";let Be=s.measureText(j);s.fillRect(A,U-25,Be.width+10,25),s.fillStyle="white",s.fillText(j,A+5,U-5)})}#f(){D(this.#n)&&(this.#e=new Worker(new URL("worker-I6GPF4ZQ.js",import.meta.url),{type:"module"}),this.#e.onmessage=t=>{let{type:e,id:i,result:a,error:s}=t.data;switch(e){case"progress":this.downloadProgress.set({key:t.data.key,current:t.data.current,total:t.data.total}),this.#t.markForCheck();break;case"result":this.#v(i,a);break;case"error":console.error("Worker error:",s),this.#c(i);break;case"modelLoaded":setTimeout(()=>{this.downloadProgress.set(Ee),this.#t.markForCheck()},1e3);break}},this.#e.onerror=t=>{console.error("Worker error:",t),this.#r.openDialog(`Worker error: ${t.message}`,{title:"Worker Error",modal:!0})})}#v(t,e){let{detections:i,imageData:a}=e;this.imageItems.update(s=>s.map(n=>n.id===t?R(S({},n),{detections:i,loading:!1,needsDrawing:!0}):n)),this.#t.markForCheck(),this.#i.set(t,{imageData:a,detections:i}),this.#s=!1,this.#d()}async ngOnInit(){this.isBrowser=D(this.#n),this.isBrowser&&this.#f()}ngOnDestroy(){this.#h(),this.imageItems().forEach(t=>{t.originalUrl&&URL.revokeObjectURL(t.originalUrl)}),this.#i.clear(),this.#e&&(this.#e.terminate(),this.#e=null)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["x-signature-detection"]],viewQuery:function(e,i){if(e&1&&(I(Le,5),I(Fe,5),I(We,5)),e&2){let a;x(a=w())&&(i.videoElement=a.first),x(a=w())&&(i.captureCanvas=a.first),x(a=w())&&(i.canvasElements=a)}},decls:40,vars:10,consts:[["fileInput",""],["videoElement",""],["captureCanvas",""],["canvas",""],["signature-detection-container",""],["href","https://kherrick.github.io/signature-detection/"],["href","https://www.npmjs.com/package/onnxruntime-web"],["tabindex","0","role","button","aria-label","Upload images",3,"dragleave","drop","dragover","click"],[1,"drop-zone-content"],[2,"margin","1rem 0 0 0"],["type","file","accept","image/*","multiple","","hidden","",3,"change"],[1,"camera-preview"],[1,"camera-controls"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","accent"],[1,"controls"],["appearance","outline"],["matInput","","type","number","min","0","max","1","step","0.1",3,"ngModelChange","ngModel"],[1,"progress-container"],[1,"images-grid"],[1,"image-card"],["autoplay","","playsinline","","muted",""],[2,"display","none"],["mat-raised-button","","color","accent",3,"click"],["mode","determinate","color","primary",3,"value"],[1,"progress-container__status"],[1,"progress-container__status--text"],[1,"skeleton"],[1,"image-container"],[3,"id"],[1,"detection-info"],[1,"download-controls"],["mat-stroked-button","","color","primary",3,"click","disabled"]],template:function(e,i){if(e&1){let a=V();r(0,"div",4)(1,"section")(2,"header")(3,"h1"),c(4,"<x-signature-detection>"),l(),r(5,"p")(6,"a",5),c(7,"Detect signatures in images with the YOLOv8 object detection model"),l(),c(8," using the "),r(9,"a",6),c(10,"ONNX Runtime Web"),l(),c(11," package. Processing happens entirely client-side and no data is sent to external servers. "),l()()(),r(12,"mat-card",7),m("dragleave",function(){return h(a),u(i.handleDragLeave())})("drop",function(n){return h(a),u(i.handleDrop(n))})("dragover",function(n){return h(a),u(i.handleDragOver(n))})("click",function(){h(a);let n=Y(19);return u(n.click())}),r(13,"div",8)(14,"mat-icon"),c(15," cloud_upload "),l(),r(16,"p",9),c(17,"Click or drag images here to upload"),l(),r(18,"input",10,0),m("change",function(n){return h(a),u(i.handleFileSelect(n))}),l()()(),v(20,He,5,2,"mat-card",11),r(21,"div",12)(22,"button",13),m("click",function(){return h(a),u(i.toggleCamera())}),r(23,"mat-icon"),c(24),l(),c(25),l(),v(26,Qe,4,0,"button",14),l(),r(27,"div",15)(28,"mat-form-field",16)(29,"mat-label"),c(30,"Confidence Threshold"),l(),r(31,"input",17),W("ngModelChange",function(n){return h(a),F(i.confThreshold,n)||(i.confThreshold=n),u(n)}),m("ngModelChange",function(){return h(a),u(i.onThresholdChange())}),l()(),r(32,"mat-form-field",16)(33,"mat-label"),c(34,"IoU Threshold"),l(),r(35,"input",17),W("ngModelChange",function(n){return h(a),F(i.iouThreshold,n)||(i.iouThreshold=n),u(n)}),m("ngModelChange",function(){return h(a),u(i.onThresholdChange())}),l()()(),v(36,$e,8,6,"div",18),r(37,"div",19),O(38,qe,7,8,"mat-card",20,ze),l()()}e&2&&(d(12),B(i.dropZoneStyles),d(8),b(i.isCameraActive()?20:-1),d(2),k("disabled",!i.isBrowser),d(2),X(i.isCameraActive()?"camera_off":"camera_alt"),d(),M(" ",i.isCameraActive()?"Stop Camera":"Start Camera"," "),d(),b(i.isCameraActive()?26:-1),d(5),L("ngModel",i.confThreshold),d(4),L("ngModel",i.iouThreshold),d(),b(i.downloadProgress().key?36:-1),d(2),N(i.reversedImageItems))},dependencies:[ae,de,le,he,ce,Me,we,Se,Te,ke,be,Ie,ye,oe,re,ve,ue,pe,me,fe,ge,_e,ie],styles:[`[signature-detection-container]{align-items:center;display:flex;flex-direction:column;max-width:60rem;padding:0 1rem;position:relative;text-align:center}[signature-detection-container] a{text-decoration:underline}[signature-detection-container] .controls{display:flex;gap:1rem}[signature-detection-container] .controls mat-form-field{max-width:40vw}[signature-detection-container] .camera-controls{display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;margin-bottom:1rem}[signature-detection-container] .camera-controls button{align-items:center;display:flex;gap:.5rem}[signature-detection-container] .camera-preview{margin-bottom:1rem;padding:1rem}[signature-detection-container] .camera-preview video{border-radius:.5rem;max-height:400px;max-width:100%}[signature-detection-container] mat-icon{font-size:4rem;height:4rem;width:4rem}[signature-detection-container] .camera-controls mat-icon{font-size:1.5rem;height:1.5rem;width:1.5rem}[signature-detection-container] .download-controls mat-icon{font-size:1.2rem;height:1.2rem;width:1.2rem;margin-right:.5rem}[signature-detection-container] .drop-zone,[signature-detection-container] .drop-zone-hover{align-items:center;border:.125rem dashed var(--md-sys-color-on-surface);cursor:pointer;display:flex;justify-content:center;margin:1rem 0 2rem;min-height:11.25rem;outline:none;padding:2rem;text-align:center;transition:background .2s}[signature-detection-container] .drop-zone{background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface)}[signature-detection-container] .drop-zone-hover{background:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary);transition:border .2s,background .2s}[signature-detection-container] .drop-zone-content{align-items:center;display:flex;flex-direction:column;width:100%}[signature-detection-container] .progress-container{align-items:center;display:flex;flex-direction:column;inset:0;justify-content:center;margin:1rem 0;width:20rem}[signature-detection-container] .progress-container mat-progress-bar{outline:.0625rem solid var(--md-sys-color-tertiary)}[signature-detection-container] .progress-container__status{margin-top:.5rem;text-align:center}[signature-detection-container] .progress-container__status--text{font-weight:700}[signature-detection-container] .images-grid{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;justify-content:space-evenly;margin-bottom:1rem}[signature-detection-container] .image-card{align-items:center;background:#fff1;border-radius:.5rem;box-shadow:0 .125rem .5rem var(--md-sys-color-on-surface);display:flex;flex-direction:column;justify-content:center;margin-bottom:.5rem;min-height:12rem;overflow:hidden;padding:1rem;position:relative;width:18rem}[signature-detection-container] .image-card .image-container{align-items:center;display:flex;flex-direction:column;width:100%}[signature-detection-container] .image-card canvas,[signature-detection-container] .image-card img{border-radius:.25rem;max-height:200px;max-width:100%;object-fit:contain}[signature-detection-container] .image-card .detection-info{color:var(--md-sys-color-on-surface);font-size:.875rem;margin-top:.5rem;text-align:center}[signature-detection-container] .image-card .download-controls{margin-top:.5rem;display:flex;gap:.5rem;justify-content:center}[signature-detection-container] .image-card .download-controls button{display:flex;align-items:center;font-size:.875rem}[signature-detection-container] .skeleton{animation:skeleton-loading 1.2s infinite;background:linear-gradient(90deg,#e0e0e088 25%,#f5f5f588,#e0e0e088 75%);background-size:200% 100%;border-radius:.5rem;height:100%;left:0;position:absolute;top:0;width:100%;z-index:1}@keyframes skeleton-loading{0%{background-position:200% 0}to{background-position:-200% 0}}
`],encapsulation:3})};export{Ce as XSignatureDetection};
