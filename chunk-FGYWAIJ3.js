import{a as N,b as S}from"./chunk-DKJ3DTS5.js";import{a as E,b as T}from"./chunk-DAQOROHW.js";var b=(s,e="",a="")=>{let i=s.createElement("a");i.setAttribute("href",a),i.textContent="Comments";let t=s.createElement("span");if(t.setAttribute("class","descendants-container"),t.appendChild(i),e){let n=s.createElement("span");n.setAttribute("class","descendants"),n.textContent=`: ${e}`,t.appendChild(n)}return t};var v=async s=>{let{document:e,dateTime:a,itemComments:i,itemLink:t,itemTitle:n,handleText:c=null,fetchItemDetails:l=""}=s,o=encodeURIComponent(i),r=e.createElement("section");r.setAttribute("id",`${o}`);let m=e.createElement("a");m.textContent=N(n.replace(/\0/g,"")),m.setAttribute("class","item"),m.setAttribute("href",t);let p=e.createElement("h3");p.appendChild(m),r.appendChild(p);let d=e.createElement("span"),[u,H]=a.split(",");d.textContent=`${u.replace("24:","00:")} @ ${H}`;try{let x=e.createElement("span");x.setAttribute("class","points"),x.textContent="0";let I=e.createElement("span");I.setAttribute("class","points-container"),I.textContent="Points: ",I.appendChild(x);let w=e.createElement("section"),h=e.createElement("h4");if(h.appendChild(d),h.appendChild(I),w.appendChild(h),l){let{descendants:g,score:y,type:C,text:k}=await(await fetch(l)).json();if(y&&(x.textContent=y),typeof g=="number"&&(C==="story"||C==="poll")){let O=b(e,`${g}`,i);h.appendChild(O)}c&&c(k,w)}else{let g=b(e,"",i);h.appendChild(g),w.appendChild(h)}r.appendChild(w)}catch{}return r};var A=async(s,e,a)=>{try{let{date:i,time:t,itemComments:n,itemTitle:c,itemLink:l}=s,o=await v({document,dateTime:`${i}, ${t}`,itemComments:n,itemLink:l,itemTitle:c.replace(/\\/g,""),fetchItemDetails:""});o.querySelector(".points-container")?.remove();let r=o.getAttribute("id");a.getElementById(`${r}`)||(a.getElementById("latest").appendChild(o),e.addItemById(`${r}`))}catch{}};var L=async(s,e,a)=>{let i=Object.values(e.index),t=e.currentTimeIndex??0;for(let n of i)t<e.index.length&&(A(i[t],a,s),t=t+1);f.newsState.currentTimeIndex=t,a.flush()};var D=async(s,e)=>{let a=s?.slice(0,10),i=a?.slice(0,4);return(await(await fetch(`${e}${i}/${a}/index.md`)).text()).split(`
`).filter(t=>t.match(new RegExp("^\\* \\["))).map(t=>{let n=t.replace("* ","").split("]("),c=n[0].slice(1),l=n[1].split(") - [")[0],o=n[1].split(") - [")[1],r=n[2].slice(0,-1),m=c.slice(0,10),p=c.slice(-8);return{date:m,itemComments:l,itemLink:r,itemTitle:o,time:p}})};var f=globalThis,Z=(s,e,a,i)=>{let t=async(d,u)=>{d.isIntersecting&&(await U(-1,s,i),L(s,e,u))},n=s.getElementById("archives"),c={root:null,rootMargin:"0px",threshold:0},l=d=>{d.forEach(async u=>t(u,a))},o=new IntersectionObserver(l,c);n&&setTimeout(()=>{o.observe(n)},250);let r=!0,m=()=>{r=!r,r?o.observe(n):o.disconnect();for(let d of Array.from(s.querySelectorAll("#latest > section")))d.style.display=r?"block":"none"},p=s.querySelector("#latest > h2");p.style.cursor="pointer",p.addEventListener("click",m)},U=async(s=0,e,a)=>{let i=e?.getElementById("latest")?.querySelector("section:last-child > section > h4 > span")?.textContent,t=S(i??"",s),n=[];try{n=await D(t,a)}catch{}let c=n.findIndex(({time:o})=>o===t?.slice(-8)),l=(o,r=[])=>(o.forEach(m=>{r.push(m)}),r);f.newsState=T(E({},f.newsState),{index:l(n,f.newsState.index),nextTimeIndex:c})},$=class{#e=[];#t=!1;#n;constructor(e){this.#n=e}addItemById(e){this.#e.push(e)}async flush(){this.#e.shift()?(this.#t=!0,await this.flush()):(this.#t=!1,"requestAnimationFrame"in globalThis&&requestAnimationFrame(async()=>{!this.#t&&this.#e&&this.#e.length&&await this.flush()}))}};export{f as a,Z as b,U as c,$ as d,L as e};
