import{a as q,b as G}from"./chunk-R5HUIKZV.js";import{a as A,b as H}from"./chunk-NNRU5O4N.js";import{a as Q}from"./chunk-HFAQQ3MF.js";import{a as $,f as W}from"./chunk-YMII22LY.js";import"./chunk-IDN5DYBR.js";import"./chunk-PKQDKLAP.js";import{l as U,m as Z,q as D}from"./chunk-ATYHLBKA.js";import{Ab as L,Bb as y,Cb as o,Cc as j,Da as S,Db as a,Dc as N,Eb as b,Ib as z,Mb as w,Ob as T,Ta as P,Va as m,Yb as O,Zb as _,ac as F,ba as u,bc as l,dc as x,fb as M,ga as c,ha as g,nc as V,pc as X,ra as k,wb as C,xb as R,zb as B}from"./chunk-PMUBQ4SH.js";import{a as v,b as h}from"./chunk-DAQOROHW.js";function J(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+n/4).toString(16))}var re=(n,e)=>e.id;function te(n,e){if(n&1&&(o(0,"div",8),b(1,"mat-progress-bar",11),o(2,"div",12)(3,"div",13),l(4),a(),o(5,"div"),l(6),V(7,"number"),a()()()),n&2){let r=T();m(),y("value",r.downloadProgress().current/r.downloadProgress().total*100),m(3),x(" ",r.downloadProgress().key," "),m(2),x(" ",X(7,3,r.downloadProgress().current/r.downloadProgress().total*100,"1.0"),"% ")}}function oe(n,e){if(n&1&&(o(0,"mat-card",10),b(1,"div",14)(2,"img",15),a()),n&2){let r=e.$implicit;m(),_("display",r.loading?"":"none"),m(),_("display",r.loading?"none":""),y("src",r.url||"",P)}}var Y={key:"",current:0,total:0},K=class n{imageItems=k([]);downloadProgress=k(Y);dropZoneStyles="drop-zone";#o=u(N);#a=u(S);#d=u(Q);#e=D(this.#a)?new Worker(new URL("worker-FZNYOOGF.js",import.meta.url),{type:"module"}):void 0;#r=!1;#n=[];handleFileSelect(e){let r=e.target.files;r&&this.#s(r),e.target.value=""}handleDrop(e){e.preventDefault(),this.dropZoneStyles="drop-zone",this.#o?.markForCheck(),e.dataTransfer?.files&&this.#s(e.dataTransfer.files)}handleDragLeave(){this.dropZoneStyles="drop-zone",this.#o?.markForCheck()}handleDragOver(e){e.preventDefault(),this.dropZoneStyles="drop-zone-hover",this.#o?.markForCheck()}#s(e){let r={debug:j(),device:"cpu",model:"isnet_quint8",proxyToWorker:!0};for(let t=0;t<e.length;t++){let i;try{i=globalThis.crypto.randomUUID()}catch{i=J()}this.imageItems.update(s=>[...s,{id:i,loading:!0}]),this.#n.push({config:r,file:e[t],id:i})}this.#i()}#i(){if(this.#r||this.#n.length===0)return;let{file:e,id:r,config:t}=this.#n.shift();this.#r=!0,this.#e?.postMessage({imgSrc:e,config:t,id:r})}#t(e){let r=JSON.stringify(e);e.data.error!==null&&(r=e.data.error),this.#d.openDialog(`Background removal has errored: ${r}`,{title:"Background Removal Error",modal:!0}),this.#r=!1,this.#i()}#l(e){let{type:r,key:t,current:i,total:s,result:d,error:E,id:I}=e.data;if(E){this.#t(e);return}if(r==="error"){console.error("Background removal failed:",E),this.#r=!1,this.#i();return}if(r==="progress"&&t&&s){console.log(`Progress ${t}: ${i} of ${s}`),this.downloadProgress.update(p=>h(v({},p),{key:t,current:i,total:s})),this.#o.markForCheck();return}if(r==="result"&&d&&I){let p=URL.createObjectURL(d);this.imageItems.update(ee=>ee.map(f=>f.id===I?h(v({},f),{url:p,loading:!1}):f)),this.#r=!1,this.downloadProgress.set(Y),this.#i()}}async ngOnInit(){D(this.#a)&&(this.#e?.addEventListener("error",e=>this.#t(e)),this.#e?.addEventListener("messageerror",e=>this.#t(e)),this.#e?.addEventListener("message",e=>this.#l(e)))}ngOnDestroy(){this.#e?.removeEventListener("error",e=>this.#t(e)),this.#e?.removeEventListener("messageerror",e=>this.#t(e)),this.#e?.removeEventListener("message",e=>this.#l(e)),this.#e?.terminate()}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=M({type:n,selectors:[["x-background-removal"]],decls:25,vars:3,consts:[["fileInput",""],["background-removal-container",""],["href","https://www.npmjs.com/package/@imgly/background-removal"],["href","https://www.npmjs.com/package/onnxruntime-web"],["tabindex","0","role","button","aria-label","Upload images",3,"dragleave","drop","dragover","click"],[1,"drop-zone-content"],[2,"margin","1rem 0 0 0"],["type","file","accept","image/*","multiple","","hidden","",3,"change"],[1,"progress-container"],[1,"images-grid"],[1,"image-card"],["mode","determinate","color","primary",3,"value"],[1,"progress-container__status"],[1,"progress-container__status--text"],[1,"skeleton"],["alt","Processed image",3,"src"]],template:function(r,t){if(r&1){let i=z();o(0,"div",1)(1,"section")(2,"header")(3,"h1"),l(4,"<x-background-removal>"),a(),o(5,"p"),l(6," Remove backgrounds from images without sending anything to a remote server with "),o(7,"a",2),l(8,"@imgly/background-removal"),a(),l(9,". It utilizes the powerful "),o(10,"a",3),l(11,"ONNX Runtime Web"),a(),l(12," allowing for client-side processing and maximum compatibility across hardware. "),a()()(),o(13,"mat-card",4),w("dragleave",function(){return c(i),g(t.handleDragLeave())})("drop",function(d){return c(i),g(t.handleDrop(d))})("dragover",function(d){return c(i),g(t.handleDragOver(d))})("click",function(){c(i);let d=O(20);return g(d.click())}),o(14,"div",5)(15,"mat-icon"),l(16," cloud_upload "),a(),o(17,"p",6),l(18,"Click or drag images here to upload"),a(),o(19,"input",7,0),w("change",function(d){return c(i),g(t.handleFileSelect(d))}),a()()(),C(21,te,8,6,"div",8),o(22,"div",9),B(23,oe,3,5,"mat-card",10,re),a()()}r&2&&(m(13),F(t.dropZoneStyles),m(8),R(t.downloadProgress().key?21:-1),m(2),L(t.imageItems()))},dependencies:[Z,W,$,H,A,G,q,U],styles:[`[background-removal-container]{align-items:center;display:flex;flex-direction:column;padding:0 1rem;position:relative;max-width:60rem;text-align:center}[background-removal-container] a{text-decoration:underline}[background-removal-container] mat-icon{font-size:4rem;height:4rem;width:4rem}[background-removal-container] .drop-zone,[background-removal-container] .drop-zone-hover{align-items:center;border:.125rem dashed var(--md-sys-color-on-surface);cursor:pointer;display:flex;justify-content:center;margin:1rem 0 2rem;min-height:11.25rem;outline:none;padding:2rem;text-align:center;transition:background .2s}[background-removal-container] .drop-zone{background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface)}[background-removal-container] .drop-zone-hover{background:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary);transition:border .2s,background .2s}[background-removal-container] .drop-zone-content{align-items:center;display:flex;flex-direction:column;width:100%}[background-removal-container] .progress-container{align-items:center;display:flex;flex-direction:column;inset:0;justify-content:center;margin:1rem 0 2rem;width:20rem}[background-removal-container] .progress-container mat-progress-bar{outline:.0625rem solid var(--md-sys-color-tertiary)}[background-removal-container] .progress-container__status{margin-top:.5rem;text-align:center}[background-removal-container] .progress-container__status--text{font-weight:700}[background-removal-container] .images-grid{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;justify-content:space-evenly}[background-removal-container] .image-card{align-items:center;background:#fff1;border-radius:.5rem;box-shadow:0 .125rem .5rem var(--md-sys-color-on-surface);display:flex;height:9.375rem;justify-content:center;margin-bottom:.5rem;overflow:hidden;position:relative;width:9.375rem}[background-removal-container] .image-card img{max-height:100%;max-width:100%;object-fit:cover;position:relative;z-index:2}[background-removal-container] .skeleton{animation:skeleton-loading 1.2s infinite;background:linear-gradient(90deg,#e0e0e088 25%,#f5f5f588,#e0e0e088 75%);background-size:200% 100%;border-radius:.5rem;height:100%;left:0;position:absolute;top:0;width:100%;z-index:1}@keyframes skeleton-loading{0%{background-position:200% 0}to{background-position:-200% 0}}
`],encapsulation:3})};export{K as XBackgroundRemoval};
